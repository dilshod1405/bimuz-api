# NOTE: This file is maintained in parallel with api_docs.txt
#       Both files contain the same information in different formats.
#       When updating API documentation, please update both files.

api:
  name: "BIMUZ API"
  version: "1.0"
  base_url: "/api/v1/"
  documentation_format: "YAML"

interactive_documentation:
  swagger_ui:
    url: "http://localhost:8000/swagger/"
    description: "Interactive API documentation with 'Try it out' functionality"
    features:
      - "Test endpoints directly from the browser"
      - "View request/response schemas"
      - "Authenticate using JWT Bearer tokens"
  
  redoc:
    url: "http://localhost:8000/redoc/"
    description: "Beautiful, responsive API documentation"
    features:
      - "Clean, readable documentation"
      - "Search functionality"
  
  openapi_schema:
    json: "http://localhost:8000/swagger.json"
    yaml: "http://localhost:8000/swagger.yaml"
    description: "Machine-readable OpenAPI 3.0 schema for API clients"
  
  note: "Replace localhost:8000 with your actual server domain in production."

authentication:
  type: "JWT Bearer Token"
  header: "Authorization: Bearer <access_token>"
  access_token_lifetime: "1 hour"
  refresh_token_lifetime: "7 days"
  token_rotation: true
  description: |
    All protected endpoints require JWT authentication. Include the access token
    in the Authorization header. Access tokens expire after 1 hour. Use the
    refresh token endpoint to get a new access token. Refresh tokens expire
    after 7 days and are automatically rotated on use.

endpoints:
  employee_authentication:
    registration:
      method: "POST"
      path: "/api/v1/auth/register/"
      authentication_required: false
      description: "Register a new employee account with user and employee profile"
      
      headers:
        Content-Type: "application/json"
      
      request_body:
        type: "object"
        required_fields:
          - email
          - first_name
          - last_name
          - password
          - password_confirm
          - full_name
          - role
        conditional_fields:
          speciality_id:
            condition: "Required only if role='mentor'"
            options:
              - "revit_architecture"
              - "revit_structure"
              - "tekla_structure"
            note: "Must be null/empty for non-mentor roles"
        optional_fields:
          - avatar
        schema:
          email:
            type: "string"
            format: "email"
            max_length: null
            unique: true
            description: "Valid email address (unique)"
          first_name:
            type: "string"
            max_length: 150
            description: "Employee's first name"
          last_name:
            type: "string"
            max_length: 150
            description: "Employee's last name"
          password:
            type: "string"
            write_only: true
            description: "Password (must pass Django password validators)"
          password_confirm:
            type: "string"
            write_only: true
            description: "Password confirmation (must match password)"
          full_name:
            type: "string"
            max_length: 255
            description: "Employee's full name"
          role:
            type: "string"
            enum:
              - "dasturchi"
              - "direktor"
              - "administrator"
              - "sotuv_agenti"
              - "mentor"
              - "assistent"
            description: "Employee role"
          speciality_id:
            type: "string"
            enum:
              - "revit_architecture"
              - "revit_structure"
              - "tekla_structure"
            nullable: true
            description: "Speciality (required only for mentors)"
          avatar:
            type: "file"
            nullable: true
            description: "Image file (upload via multipart/form-data)"
      
      example_request:
        email: "employee@example.com"
        first_name: "John"
        last_name: "Doe"
        password: "SecurePassword123!"
        password_confirm: "SecurePassword123!"
        full_name: "John Doe"
        role: "mentor"
        speciality_id: "revit_architecture"
        avatar: null
      
      success_response:
        status_code: 201
        description: "Employee registered successfully"
        schema:
          success: true
          message: "Employee registered successfully."
          data:
            employee:
              id: 1
              email: "employee@example.com"
              first_name: "John"
              last_name: "Doe"
              full_name: "John Doe"
              role: "mentor"
              role_display: "Mentor"
              speciality_id: "revit_architecture"
              speciality_display: "Revit Architecture"
              avatar: null
              avatar_url: null
              created_at: "2026-01-10T12:00:00Z"
              updated_at: "2026-01-10T12:00:00Z"
            tokens:
              refresh: "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9..."
              access: "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9..."
      
      error_responses:
        - status_code: 400
          description: "Validation errors"
          schema:
            success: false
            message: "Validation error"
            errors:
              email: ["Employee with this email already exists."]
              password_confirm: ["Passwords do not match."]
              speciality_id: ["Speciality is required for Mentors."]
      
      validation_rules:
        - "Email must be unique across all users"
        - "Password must meet Django's password validation requirements"
        - "Password and password_confirm must match"
        - "If role is 'mentor', speciality_id is required"
        - "If role is not 'mentor', speciality_id must be null/empty"

    login:
      method: "POST"
      path: "/api/v1/auth/login/"
      authentication_required: false
      description: "Authenticate an employee and receive JWT tokens"
      
      headers:
        Content-Type: "application/json"
      
      request_body:
        type: "object"
        required_fields:
          - email
          - password
        schema:
          email:
            type: "string"
            format: "email"
            description: "Valid email address of registered employee"
          password:
            type: "string"
            write_only: true
            description: "User's password"
      
      example_request:
        email: "employee@example.com"
        password: "SecurePassword123!"
      
      success_response:
        status_code: 200
        description: "Login successful"
        schema:
          success: true
          message: "Login successful."
          data:
            employee:
              id: 1
              email: "employee@example.com"
              first_name: "John"
              last_name: "Doe"
              full_name: "John Doe"
              role: "mentor"
              role_display: "Mentor"
              speciality_id: "revit_architecture"
              speciality_display: "Revit Architecture"
              avatar: "/media/avatars/employees/avatar.jpg"
              avatar_url: "http://example.com/media/avatars/employees/avatar.jpg"
              created_at: "2026-01-10T12:00:00Z"
              updated_at: "2026-01-10T12:00:00Z"
            tokens:
              refresh: "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9..."
              access: "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9..."
      
      error_responses:
        - status_code: 400
          description: "Invalid credentials or no employee profile"
          schema:
            success: false
            message: "Validation error"
            errors:
              email: ["Invalid email or password."]
        - status_code: 400
          description: "No employee profile found"
          schema:
            success: false
            message: "Validation error"
            errors:
              email: ["No employee profile found for this user."]
      
      notes:
        - "For security reasons, the same error message is returned for both invalid email and invalid password to prevent user enumeration."

    profile_get:
      method: "GET"
      path: "/api/v1/auth/profile/"
      authentication_required: true
      description: "Retrieve the authenticated employee's profile information"
      
      headers:
        Authorization: "Bearer <access_token>"
        Content-Type: "application/json"
      
      success_response:
        status_code: 200
        description: "Employee profile retrieved successfully"
        schema:
          success: true
          message: "Employee profile retrieved successfully."
          data:
            id: 1
            email: "employee@example.com"
            first_name: "John"
            last_name: "Doe"
            full_name: "John Doe"
            role: "mentor"
            role_display: "Mentor"
            speciality_id: "revit_architecture"
            speciality_display: "Revit Architecture"
            avatar: "/media/avatars/employees/avatar.jpg"
            avatar_url: "http://example.com/media/avatars/employees/avatar.jpg"
            created_at: "2026-01-10T12:00:00Z"
            updated_at: "2026-01-10T12:00:00Z"
      
      error_responses:
        - status_code: 401
          description: "Missing or invalid token"
          schema:
            detail: "Authentication credentials were not provided."
        - status_code: 404
          description: "Employee profile not found"
          schema:
            detail: "Employee profile not found."

    profile_update:
      method: "PATCH"
      path: "/api/v1/auth/profile/"
      authentication_required: true
      description: "Update the authenticated employee's profile (partial update allowed)"
      
      headers:
        Authorization: "Bearer <access_token>"
        Content-Type: "application/json (or multipart/form-data for avatar upload)"
      
      request_body:
        type: "object"
        all_fields_optional: true
        allowed_fields:
          - full_name
          - speciality_id
          - avatar
        read_only_fields:
          - id
          - email
          - first_name
          - last_name
          - role
          - created_at
          - updated_at
        schema:
          full_name:
            type: "string"
            max_length: 255
            description: "Employee's full name"
          speciality_id:
            type: "string"
            enum:
              - "revit_architecture"
              - "revit_structure"
              - "tekla_structure"
            description: "Speciality (only if role is 'mentor')"
          avatar:
            type: "file"
            description: "Image file (use multipart/form-data)"
      
      example_request:
        full_name: "John Updated Doe"
        speciality_id: "revit_structure"
      
      validation_rules:
        - "If role is 'mentor', speciality_id can be updated but cannot be removed"
        - "If role is not 'mentor', speciality_id cannot be set"
      
      success_response:
        status_code: 200
        description: "Employee profile updated successfully"
        schema:
          success: true
          message: "Employee profile updated successfully."
          data:
            id: 1
            email: "employee@example.com"
            first_name: "John"
            last_name: "Doe"
            full_name: "John Updated Doe"
            role: "mentor"
            role_display: "Mentor"
            speciality_id: "revit_structure"
            speciality_display: "Revit Structure"
            avatar: "/media/avatars/employees/new_avatar.jpg"
            avatar_url: "http://example.com/media/avatars/employees/new_avatar.jpg"
            created_at: "2026-01-10T12:00:00Z"
            updated_at: "2026-01-10T13:30:00Z"
      
      error_responses:
        - status_code: 400
          description: "Validation errors"
          schema:
            success: false
            message: "Validation error"
            errors:
              speciality_id: ["Speciality is required for Mentors."]
        - status_code: 401
          description: "Missing or invalid token"
        - status_code: 404
          description: "Employee profile not found"

    token_refresh:
      method: "POST"
      path: "/api/v1/auth/token/refresh/"
      authentication_required: false
      description: "Get a new access token using a refresh token"
      note: |
        When a refresh token is used, it is automatically rotated (blacklisted)
        and a new refresh token should be stored. However, this endpoint only
        returns the new access token. Use the login endpoint if you need both
        tokens.
      
      headers:
        Content-Type: "application/json"
      
      request_body:
        type: "object"
        required_fields:
          - refresh
        schema:
          refresh:
            type: "string"
            description: "Valid refresh token string"
      
      example_request:
        refresh: "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9..."
      
      success_response:
        status_code: 200
        description: "New access token generated"
        schema:
          access: "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9..."
      
      error_responses:
        - status_code: 401
          description: "Invalid or expired refresh token"
          schema:
            detail: "Token is invalid or expired"
            code: "token_not_valid"

enums:
  employee_roles:
    description: "Employee Roles"
    values:
      - key: "dasturchi"
        display: "Dasturchi"
      - key: "direktor"
        display: "Direktor"
      - key: "administrator"
        display: "Administrator"
      - key: "sotuv_agenti"
        display: "Sotuv agenti"
      - key: "mentor"
        display: "Mentor"
      - key: "assistent"
        display: "Assistent"
  
  speciality_values:
    description: "Speciality Values (for Mentors only)"
    values:
      - key: "revit_architecture"
        display: "Revit Architecture"
      - key: "revit_structure"
        display: "Revit Structure"
      - key: "tekla_structure"
        display: "Tekla Structure"

response_format:
  success:
    schema:
      success: true
      message: "Operation successful message"
      data: {}  # Response data
  
  error:
    schema:
      success: false
      message: "Error message"
      errors: {}  # Field-specific errors (if applicable)
  
  note: |
    Some endpoints may return Django REST Framework's default error format
    for certain error types (e.g., 401 Unauthorized).

http_status_codes:
  200: "OK - Request successful"
  201: "Created - Resource created successfully"
  400: "Bad Request - Validation errors or invalid input"
  401: "Unauthorized - Authentication required or invalid token"
  404: "Not Found - Resource not found"
  500: "Internal Server Error - Server error"

notes:
  - "Students do NOT have login/registration endpoints as this is not an online learning platform. Students are managed through admin panel or by employees."
  - "All timestamps are in ISO 8601 format (UTC)."
  - "Avatar URLs are absolute URLs when available in request context."
  - "Password validation follows Django's default validators: Minimum length validation, Common password validation, Numeric password validation, User attribute similarity validation."
  - "JWT tokens are stored in memory on the client side. Access tokens should be refreshed before expiration to maintain session."
  - "All file uploads (avatars) should use multipart/form-data content type."
  - "The API uses API versioning (/api/v1/) for backward compatibility when new versions are released."

metadata:
  last_updated: "2026-01-10"
  apis_documented:
    - "Employee Registration (POST /api/v1/auth/register/)"
    - "Employee Login (POST /api/v1/auth/login/)"
    - "Employee Profile - Get (GET /api/v1/auth/profile/)"
    - "Employee Profile - Update (PATCH /api/v1/auth/profile/)"
    - "Token Refresh (POST /api/v1/auth/token/refresh/)"
  documentation_version: "1.0"
